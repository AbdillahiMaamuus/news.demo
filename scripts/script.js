// Default articles organized by category
const defaultArticles = [
    // News Articles (ID:1, ID:3)
    {
        id: 1,
        title: "Digniin: Ku dhowaad saddex meelood meel reer Qasa cunto ma cunaan",
        summary: "Walaaca caalamiga ah ayaa kordhay toddobaadkan iyadoo laga digayo in macmuul ay saameysay Qasa",
        content: `Ku dhowaad saddexdii qof ee ku nool Marinka Qasa mid ka mid ah ayaa maalmo aan wax cunin, barnaamijka gargaarka cuntada ee Qaramada Midoobay ayaa ka digay.

                "Nafaqo-xumada ayaa sii kordheysa iyadoo 90,000 oo haween iyo carruur ah ay u baahan yihiin daweyn degdeg ah," ayaa lagu yiri warbixin ay soo saartay Hay'adda Cunnada Adduunka ee WFP.

                Digniinaha ku saabsan gaajada Qasa ayaa sii kordhay toddobaadkan. Sagaal qof oo kale ayaa u dhintay nafaqo darro Jimcihii, sida ay sheegtay wasaaradda caafimaadka ee dhulka Falastiin ee ay maamusho Xamaas - taasoo tirada guud ee dhimashada tan iyo markii uu dagaalku billowday ka dhigaysa 122.

                Israa'iil oo gacanta ku haysa gelitaanka dhammaan sahayda Qasa, ayaa sheegtay in aanay jirin wax xannibaad ah oo ku aaddan in gargaarku soo galo dhulkaas, waxaanay Xamaas ku eedaysay nafaqo-xumo kasta oo jirta.

                Jimcihii, ra'iisul wasaaraha UK, Sir Keir Starmer ayaa soo jeediyay in UK ay door ka qaadan doonto sidii gargaarka loogu daad gurayn lahaa Qasa ka dib markii in ka badan saddex meelood meel xubnaha baarlamaanka ay saxiixeen warqad ay ugu baaqayaan dowladda inay aqoonsato dowlad Falastiin ah.`,
        image: "images/img1.jpg/",
        category: "news",
        date: "2025-7-05"
    },
    {
        id: 3,
        title: "Madaxweynaha Soomaaliya oo kulan la qaatay Madaxweynaha Jabuuti",
        summary: "Madaxweynaha Soomaaliya oo kulan la qaatay Madaxweynaha Jabuuti.",
        content: `Madaxweynaha Jamhuuriyadda Federaalka Soomaaliya, Xasan Sheekh Maxamuud, ayaa saaka kulan kula yeeshay Xarunta Madaxtooyada Jabuuti Madaxweynaha Jamhuuriyadda Jabuuti, Ismaaciil Cumar Geelle, sida ay baahisay warbaahinta dowladda.

                Labada mas'uul ayaa ka wada hadlay "xoojinta xiriirka istiraatijiyadeed ee ka dhexeeya dalalkooda, iyadoo diiradda lagu saaray xoojinta iskaashiga labada dal, sida amniga, dagaalka ka dhanka ah al-Shabaab, iyo sidii Jabuuti ay u sii wadi lahayd taageerada dowlad dhisidda iyo xasilinta Soomaaliya."

                Waxaa kale oo shirka lagaga hadlay arrimaha bini'aadantinimada, gaar ahaan dhibaatada abaartu keentay ee saamaysay qaybo ka mid ah Soomaaliya.

                Madaxweyne Xasan Sheekh ayaa ka codsaday Jabuuti inay gacan ka geysato sidii gargaar waqtigeeda loo gaarsiin lahaa bulshada ay abaaruhu saameeyeen.

                Kulankan ayaa ah mid ka mid ah kulamada ay yeesheen madaxda labada dal tan iyo markii Madaxweyne Xasan Sheekh Maxamuud ku guuleystey doorashadii Madaxtooyada. Waxaana laga wada filayaa inay ka dhaliilan doonaan horumarinta xiriirka labada dal iyo sidii loo xoojin lahaa iskaashiga dhinacyada kala duwan.

                Jabuuti ayaa ah mid ka mid ah dalalka IGADka, waxaana ay taageero weyn u fidaysay Soomaaliya dhinacyada amniga, maamulka iyo horumarinta.`,
        image: "images/image1.jpg",
        category: "news",
        date: "2025-7-1"
    },
    
    // Technology Articles (ID:2, ID:4)
    {
        id: 2,
        title: "Wax ka ogow IPhone cusub ee qiimahiisu jaban yahay ee ku shaqeynaya garaadka macmalka ah ee AI",
        summary: "Shirkadda Apple ayaa ku dhawaaqday iPhone cusub oo leh islamarkana ku shaqeeya astaamaha garaadka macmalka (AI) .",
        content: ` Noocan cusub ee Iphone-ka ayaa qiimo ahaan jaban marka loo eego noocyadii horey loo soo saaray.

                    Apple waxay sheegtay in iPhone 16e uu leeyahay processor la mid ah kan iPhone 16 ee qaaliga ah, islamarkana qaadi kara oo kaydin kara macluumaad badan, in kasta oo meeelaha qaar uu ka hooseeyo , sida kamaradaha yar-yar oo kale.

                    Shirkadda Apple ayaa dhawaanahan ku la daalaa dhacaysay sidii ay u heli lahayd aalado cusub oo ay xiisayn karaan macaamiisha, xilli iibka iPhone uu hoos u dhacay dhammaadkii sannadkii hore.

                    Shirkaddu waxay rajaynaysaa in soo bandhigida iyo hagaajinta taleefoon leh garaadka macmalka AI oo qaali ah ay wax ka qaban doonto arrintan, inkasta oo falanqeeyayaasha ay taxadar ka muujiyeen kor u kaca iibka qalabkan oo kale laga yaabo inuu keeno.

                    Magaca talefanku waxa uu si cad u tixraacayaa taxanaha iPhone SE oo soo socday intii u dhaxaysay 2016 ilaa 2022, kaas oo sidoo kale lahaa qiimooyiin kala duwan.

                    Shirkadda Apple waxay sheegtay in iPhone 16e uu diyaar ahaan islamarkana uu suuqyada soo gali doono 21 Febraayo, 2025.

                    
                    Waxaa taleefoonkan noocan cusub laga heli doonaa marka hore 59 wadan oo caalamka daafihiisa ku kala yaalla.

                    Qiimaha la iibin doono taleefoonkan iPhone 16e dalka UK waa $759, taas oo $253 ka yar iPhone 16, laakiin in ka badan laba-laab qiimihii iPhone SE uu ku soo baxay markii ugu horeysay sanadkii 2016.

                    "Kani hadda waa mid ka mid ah iPhones-ka ugu awoodda badan ee suuqa soo galay," waxaa sidaa BBC u sheegay Paolo Pescatore oo ah falanqeeye dhinaca warshadaha.

                    "Tallaabadan waa in ay gacan ka geysato dardargelinta qaadashada taleefoonka, gaar ahaan Apple oo si xooggan u soo gashay dhinaca garaadka macmalka ah iyada oo loo marayo (Apple Intelligence)," ayuu intaa raaciyay.
                    `,
        image: "images/image7.jpg",
        category: "technology",
        date: "2025-6-12"
    },
    {
        id: 4,
        title: "Barnaamijka uu soo kordhiyay Instagram ee aad ku go'aamin karto waxa kaaga soo hor bixi kara bartooda",
        summary: "Instagram ayaa tijaabinaysa barnaamij cusub kaas oo dadka u oggolaanaya in ay gabi ahaanba meesha ka saaraan dhammaan waxyaabaha iyaga oo aan rabin uga soo horbaxa marka ay galaan app ka.",
        content: `Barnaamijkaan oo lagu magacaabo "reset" micnaheeduna yahay dib u hagaajin - ayay sheegtay shirkaddu in dunida oo dhan u furnaan doon "dhawaan" - waxay si wax ku ool ah u nadiifin doontaa dhamaan waxyaabaha aadan rabin ee uu ku horkeenayo algorithm ka marka aad dhexgasho barta.

                    Waxay ku soo beegantay arrintani iyadoo Instagram ay ku dhawaaqday barnaamijyo dhowr ah oo cusub oo looga golleeyahay in lagu kor loogu qaado caafimaad qabka barta, sidoo kale barnaamijyo badqabka dadka ah ayaa la keeni doonaa bisha October oo loogu talo galay ciyaalka aan qaangaarka ahayn eek u soo biiraya barta bulsho.

                    Hay’adda Maamusha warbaahinta UK, Ofcom, ayaa soo dhoweysay ku dhawaaqista arrinkaan - laakiin waxay sheegtay in loo baahanaan doono tallaabooyin kale oo dheeraad ah si baraha bulshada looga dhigo kuwa ammaan ah.

                    " Way wanaagsan tahay in la arko Instagram oo keenaya isbeddelladan ka hor inta uusan sharcigu billaabin inuu qabto, waxaana ku cadaadin doonnaa shirkadaha inay wax badan sameeyaan si ay u ilaaliyaan oo ay u garab istaagaan isticmaalayaashooda," ayaa lagu yiri bayaan ay soo saartay hay’addu.
                    <h1 style="bold">Sida loo isticmaalo</h1>
                    Meta - oo leh barta Instagram-ka - ayaa sheegaysa in nidaamka cusub uu noqon doonomid uu heli doono qof kasta oo ay ku jiraan caruurta aan qaangaarin, waxa uuna ka caawin doonaa dadka inay dib u nidaamsadaan waxyaalaha ay doonayaan in arkaan "iyaga oo raacay dhowr tallaabo oo kaliya"

                    "Waxaan rabnaa inaan hubinno in qof walba oo ku jira Instagram - gaar ahaan dhalinyarada - ay helayaan wax u qalma, ammaan ah, oo faa’ido leh, ayna dareemaan waqtiga ay ku bixinayaan Instagram inuu yahay mid qiimo leh," Meta ayaa ku tiri sidaas qoraal ay arrintaan ku baahineysay.

                    Isticmaalayaasha doonaya inay dib u cusbooneysiiyaan hadba xogta ay ku arkayaan darbigooda ayaa waxay awood u yeelan doonaan inay "iyagu doortaan waxa ay ku arki doonaan" shaashadda, iyaga oo qori doona waxay ay rabaan qaybta "xoga aad doorbideyso".`,
        image:"images/image7.jpg",
        category: "technology",
        date: "2025-10-08"
    },
    
    // Sports Articles (ID:5, ID:6)
    {
        id: 5,
        title: "Lix xiddigood oo udub-dhexaad u ah Koobka Kubadda Cagta ee Haweenka Qaramada Afrika",
        summary: "Koobka Qaramada Afrika ee Haweenka 2024 (Wafcon) ayaa ka furmay Morocco 5-tii Luulyo",
        content: `Koobka Qaramada Afrika ee Haweenka 2024 (Wafcon) ayaa ka furmay Morocco 5-tii Luulyo.

                    Koonfur Afrika ayaa dib u soo laabatay si ay u difaacdo horyaalkeeda, halka Nigeria oo sagaal jeer haysatay koobkan ay doonayso inay dib u soo ceshato koobkii ay qaadeen sannadkii 2018 kii.

                    Kuwo cusub iyo ruug-caddaayaal kasoo jeeda Waqooyiga Afrikaba, BBC Sport Africa ayaa soo bandhigtay lix ka mid ah ciyaartoyda aadka indhaha loogu hayo inta uu socdo tartankan.
                    <h1 style="font-weight: bold">Asisat Oshoala (Nigeria)</h1>
                    <img src="images/image5.jpg" alt="Asisat Oshoala" style="width: 100%; height: auto;">`,
        image: "images/image4.jpg",
        category: "sports",
        date: "2025-10-18"
    },
    {
        id: 6,
        title: "Ma waxaa la gaaray wakhtigii uu Messi ka fadhiisan lahaa cayaaraha",
        summary: "Laacibka xulka qaranka Argentina ee Lionel Messi ayaa lagu wadaa in uu ka dhaqaaqo kooxda Reer Maraykan ee Inter Miami oo martigelisay guul darro ka soo gaadhay PSG. Messi ayaa soo bandhigay mid ka mid ah xirfadihiisii layaabka lahaa.",
        content: `Laacibka xulka qaranka Argentina ee Lionel Messi ayaa lagu wadaa in uu ka dhaqaaqo kooxda Reer Maraykan ee Inter Miami oo martigelisay guul darro ka soo gaadhay PSG. Messi ayaa soo bandhigay mid ka mid ah xirfadihiisii layaabka lahaa.

                    38 jirkan ayaa lagu wadaa in aanu si dhib yar ciyaaraha uga fadhiisan iyada oo laga yaabo in uu u dheelo qarankiisa Koobka Adduunka ee sannadka 2026-ka.

                   "PSG waxa ay ku jirtaa qaab ciyaareed heer sare ah. Dad badan ayaa tigidhada u goosta si ay u daawadaan Messi oo markan da'da 40-ka u sii siqaya," ayuu yidhi madaxa Inter Miami Javier Mascherano, kaddib ciyaar ay daawadeen 65,574 oo taageerayaal ah.

                    Daafaca kooxda PSG ee Lucas Beraldo ayaa isna sifeeyay oo yidhi "Leo waa shaqsiyad gaar ah, in aan la ciyaaryo isaga waxa ay ahayd mid cajiib ah, waxa aan ahaa ilmo yar oo ku barbaaray daawashada xirfadiisa mucjisada ah."
                    <img src="images/image10.jpg" alt="Lionel Messi" style="width: 100%; height: auto;">`, 
      image: "images/image10.jpg",
        category: "sports",
        date: "2023-10-15"
    }
];

// DOM Elements
const articlesContainer = document.getElementById('articles-container');
const articleModal = document.getElementById('article-modal');
const modalContent = document.getElementById('modal-content');
const closeModal = document.getElementById('close-modal');
const categoryButtons = document.querySelectorAll('.category-btn');
const searchInput = document.getElementById('search-input');
const postArticleBtn = document.getElementById('post-article-btn');
const adminPanel = document.getElementById('admin-panel');
const articleForm = document.getElementById('article-form');
const carouselContainer = document.querySelector('.carousel');

// State variables
let currentCategory = 'all';
let currentSearchTerm = '';
let articles = [];
let featuredArticles = [];

// Initialize
function init() {
    loadArticles();
    renderArticles();
    setupCarousel();
    setupEventListeners();
    checkAdminMode();
}

// Load articles from localStorage or use defaults
function loadArticles() {
    const storedArticles = localStorage.getItem('newsArticles');
    articles = storedArticles ? JSON.parse(storedArticles) : defaultArticles;
    
    // Get featured articles (first 3)
    featuredArticles = articles.slice(0, 3);
}

// Save articles to localStorage
function saveArticles() {
    localStorage.setItem('newsArticles', JSON.stringify(articles));
}

// Render articles to the grid
function renderArticles() {
    articlesContainer.innerHTML = '';
    
    const filteredArticles = articles.filter(article => {
        const matchesCategory = currentCategory === 'all' || article.category === currentCategory;
        const matchesSearch = article.title.toLowerCase().includes(currentSearchTerm) || 
                            article.summary.toLowerCase().includes(currentSearchTerm);
        return matchesCategory && matchesSearch;
    });
    
    if (filteredArticles.length === 0) {
        articlesContainer.innerHTML = '<p class="no-results">No articles found. Try a different search or category.</p>';
        return;
    }
    
    filteredArticles.forEach(article => {
        const articleCard = document.createElement('div');
        articleCard.className = 'article-card';
        articleCard.innerHTML = `
            <img src="${article.image}" alt="${article.title}" class="article-img">
            <div class="article-content">
                <span class="article-category">${article.category.charAt(0).toUpperCase() + article.category.slice(1)}</span>
                <h3>${article.title}</h3>
                <p>${article.summary}</p>
            </div>
        `;
        articlesContainer.appendChild(articleCard);
        
        // Make entire card clickable
        articleCard.addEventListener('click', () => {
            openArticleModal(article.id);
        });
    });
}

// Setup featured articles carousel
function setupCarousel() {
    carouselContainer.innerHTML = '';
    
    featuredArticles.forEach((article, index) => {
        const slide = document.createElement('div');
        slide.className = `carousel-slide ${index === 0 ? 'active' : ''}`;
        slide.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${article.image}')`;
        slide.innerHTML = `
            <div class="slide-content">
                <h2>${article.title}</h2>
                <p>${article.summary}</p>
                <button class="read-more" data-id="${article.id}">Read Full Article</button>
            </div>
        `;
        carouselContainer.appendChild(slide);
    });
    
    // Auto-rotate carousel
    let currentSlide = 0;
    setInterval(() => {
        const slides = document.querySelectorAll('.carousel-slide');
        slides[currentSlide].classList.remove('active');
        currentSlide = (currentSlide + 1) % slides.length;
        slides[currentSlide].classList.add('active');
    }, 5000);
    
    // Add event listeners to carousel read more buttons
    carouselContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('read-more')) {
            const articleId = parseInt(e.target.dataset.id);
            openArticleModal(articleId);
        }
    });
}

// Open article modal
function openArticleModal(articleId) {
    const article = articles.find(a => a.id === articleId);
    if (!article) return;
    
    modalContent.innerHTML = `
        <img src="${article.image}" alt="${article.title}" class="modal-img">
        <span class="article-category">${article.category.charAt(0).toUpperCase() + article.category.slice(1)}</span>
        <h2>${article.title}</h2>
        <p class="article-date">Published: ${formatDate(article.date)}</p>
        <div class="article-content">${article.content.replace(/\n/g, '<br>')}</div>
    `;
    
    articleModal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

// Close article modal
function closeArticleModal() {
    articleModal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Check if admin mode is enabled
function checkAdminMode() {
    const isAdmin = window.location.search.includes('admin=true');
    if (isAdmin) {
        postArticleBtn.classList.add('active');
        adminPanel.classList.remove('active'); // Ensure panel is closed by default
    }
}

// Validate URL format
function isValidUrl(url) {
    if (!url) return true; // Allow empty
    try {
        new URL(url);
        return true;
    } catch (e) {
        return false;
    }
}

// Format date
function formatDate(dateString) {
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return new Date(dateString).toLocaleDateString(undefined, options);
}

// Setup event listeners
function setupEventListeners() {
    // Category filtering
    categoryButtons.forEach(button => {
        button.addEventListener('click', () => {
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentCategory = button.dataset.category;
            renderArticles();
        });
    });
    
    // Search functionality
    searchInput.addEventListener('input', () => {
        currentSearchTerm = searchInput.value.toLowerCase();
        renderArticles();
    });
    
    // Modal close
    closeModal.addEventListener('click', closeArticleModal);
    articleModal.addEventListener('click', (e) => {
        if (e.target === articleModal) closeArticleModal();
    });
    
    // Admin panel
    postArticleBtn.addEventListener('click', () => {
        adminPanel.classList.toggle('active');
    });

    // Article form submission
        articleForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        // Reset errors
        document.querySelectorAll('.error').forEach(el => {
            el.classList.remove('active');
        });
        
        // Get form values
        const title = document.getElementById('title').value.trim();
        const summary = document.getElementById('summary').value.trim();
        const content = document.getElementById('content').value.trim();
        const image = document.getElementById('image').value.trim();
        const category = document.getElementById('category').value;
        
        // Validate form
        let isValid = true;
        
        if (!title) {
            document.getElementById('title-error').classList.add('active');
            isValid = false;
        }
        
        if (!summary) {
            document.getElementById('summary-error').classList.add('active');
            isValid = false;
        }
        
        if (!content) {
            document.getElementById('content-error').classList.add('active');
            isValid = false;
        }
        
        if (!category) {
            document.getElementById('category-error').classList.add('active');
            isValid = false;
        }
        
        if (!isValidUrl(image)) {
            document.getElementById('image-error').classList.add('active');
            isValid = false;
        }
        
        if (!isValid) return;
        
        // Create new article
        const newArticle = {
            id: Date.now(),
            title,
            summary,
            content,
            image: image || 'https://images.unsplash.com/photo-1495020689067-958852a7765e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200',
            category,
            date: new Date().toISOString().split('T')[0]
        };
        
        // Add to articles array
        articles.unshift(newArticle);
        saveArticles();
        
        // Reset form
        articleForm.reset();
        adminPanel.classList.remove('active');
        
        // Show success message
        alert('Article published successfully!');
        
        // Refresh display
        loadArticles();
        renderArticles();
        setupCarousel();
    });
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', init);